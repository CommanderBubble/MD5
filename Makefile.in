###############################################################################
# @configure_input@
# Makefile for the DMalloc library.
# $Id: Makefile.in,v 1.3 2010-05-07 15:12:37 gray Exp $
###############################################################################

# default root installation directory
prefix = @prefix@
exec_prefix = @exec_prefix@

srcdir = @srcdir@
VPATH = @srcdir@

libdir = @libdir@
includedir = @includedir@

# default c++-compiler
CXX = @CXX@

DEFS = $(DEFINES)
INCS = -I. -I$(srcdir) $(INCLUDES)
LIBS = -L. @LIBS@
A_OUT = aout@EXEEXT@

MODULE	= md5
LIBRARY	= lib$(MODULE).a

# now construct our build and install targets
BUILD_ALL = $(LIBRARY)
INSTALL_LIB = $(LIBRARY)

ifneq ($(CXXFLAGS), )
$(info Using custom $(CXX) flags)
else
CXXFLAGS = @CXXFLAGS@
endif

LDFLAGS = @LDFLAGS@

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

###############################################################################
# End of system configuration section.
###############################################################################

SHELL = /bin/sh

HFLS = src/md5.h
OBJS = src/md5.o

TEST = tests/$(MODULE)_t

all : $(BUILD_ALL)

clean :
	rm -f $(A_OUT) core *.o *.t
	rm -f $(LIBRARY) $(TEST)
	rm -f src/*.o
	rm -f tests/*.o tests/*.t

realclean : clean

distclean : clean
	rm -f confdefs.h config.status config.log config.cache conf.*
	rm -f configure.lineno configure
	rm -rf autom4te.cache
	rm -f Makefile

installdirs :
	$(srcdir)/mkinstalldirs $(includedir) $(libdir) $(bindir)

installincs : $(HFLS)
	$(srcdir)/mkinstalldirs $(includedir)
	$(INSTALL_DATA) $(HFLS) $(includedir)

installlib : $(INSTALL_LIB)
	$(srcdir)/mkinstalldirs $(libdir)
	$(INSTALL_DATA) $(LIBRARY) $(libdir)
	@RANLIB@ $(libdir)/$(LIBRARY)

install : installincs installlib

uninstallincs : $(HFLS)
	rm -f $(includedir)/$(HFLS)

uninstalllib : $(INSTALL_LIB)
	rm -f $(libdir)/$(INSTALL_LIB)

uninstall : uninstallincs uninstalllib

$(LIBRARY) : $(OBJS) $(NORMAL_OBJS)
	ar cr $@ $?
	@RANLIB@ $@

check : $(TEST)
	./$(TEST)

$(TEST) : $(TEST).o $(LIBRARY)
	rm -f $@
	$(CXX) $(LDFLAGS) -o $(A_OUT) $(TEST).o $(LIBRARY)
	mv $(A_OUT) $@
